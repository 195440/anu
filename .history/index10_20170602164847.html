<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    

    <!--<script type='text/javascript' src="./dist/React.js"></script>-->
    <!-- <script src="./test/react.js"></script>
    <script src="./test/react-dom.js"></script>
    <script src="./test/redux.js"></script>
    <script src="./test/react-redux.js"></script>
    <script src="./test/babel.js"></script>-->
    <script>
        window.onload = function () {

            const stack = [];
            const EMPTY_CHILDREN = [];
            var React = {
                createElement: function (type, configs) {

                    var props = {},
                        key = null,
                        ref = null,
                        pChildren = null, //位于props中的children
                        props = {},
                        vtype = 1,
                        typeType = typeof type,

                        children = EMPTY_CHILDREN,
                        isEmptyProps = true
                    if (configs) {
                        for (let i in configs) {
                            var val = configs[i]
                            if (i === 'key') {
                                key = val
                            } else if (i === 'ref') {
                                ref = val
                            } else if (i === 'children') {
                                pChildren = val
                            } else {
                                isEmptyProps = false
                                props[i] = val
                            }
                        }
                    }
                    if (typeType === 'function') {
                        vtype = type.prototype && type.prototype.render ?
                            2 :
                            4
                    }
                    for (let i = 2, n = arguments.length; i < n; i++) {
                        var el = arguments[i]
                        if (el && el.pop) {
                            el.deep = 1
                        }

                        stack.push(el)
                    }
                    var lastText, child, simple, i
                    while (stack.length) {
                        //比较巧妙地判定是否为子数组
                        if ((child = stack.pop()) && child.pop !== undefined) {
                            for (i = 0; i < child.length; i++) {
                                stack.push(child[i])
                            }
                        } else {
                            if (child === null || child === void 666 || child === false || child === true){
                                continue
                            var childType = typeof child
                            if (childType !== 'object') {
                                simple = true
                                if (childType === 'number')
                                    child = child + ''
                            } else {
                                simple = child.type === '#text'
                            }

                            if (simple && lastText) {
                                lastText.text = child + lastText.text
                            } else {
                                if (childType === 'string') {
                                    child = {
                                        type: '#text',
                                        text: child
                                    }
                                    lastText = child
                                } else {
                                    lastText = null
                                }
                                if (children === EMPTY_CHILDREN) {
                                    children = [child];
                                } else {
                                    children.unshift(child);
                                }
                            }
                        }
                    }
                    props.children = children
                    return new VNode(type, props, key, vtype)

                }
            }


            function VNode(type, props, key, vtype) {
                this.type = type
                this.props = props
                this.vtype = vtype
                this.deep = 0
                if (key) {
                    this.key = key
                }

            }

            var a = React.createElement('div', {}, "aaa", "bbb", ["ccc",null, void 666, ['ddd'], 'ddd', React.createElement('span', {}),
                'eee', 'fff'
            ])

            console.log(a)
        }
    </script>
</head>

<body>

    <div>这个默认会被清掉</div>
    <div id='example'></div>


</body>

</html>